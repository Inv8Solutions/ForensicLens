
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Forensic Lens</title>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
	<style>
		:root {
			--bg: #18181a;
			--card-bg: #232326;
			--text-main: #fff;
			--text-sub: #b3b3b7;
			--progress-bg: #3a3a3d;
			--progress-bar: #ff3b3f;
			--progress-bar-bg: #ffb3b3;
			--button-bg: #ff3b3f;
			--button-bg-hover: #e22e32;
			--button-text: #fff;
			--card-border: #b3b3b733;
			--pill-bg: #35353a;
			--pill-text: #b3b3b7;
		}
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			background: var(--bg);
			color: var(--text-main);
			font-family: 'Inter', 'Montserrat', Arial, sans-serif;
			min-height: 100vh;
		}
		body {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			min-height: 100vh;
			padding: 0 0 32px 0;
		}
		.container {
			width: 100%;
			max-width: 420px;
			margin: 0 auto;
			padding: 32px 16px 0 16px;
			box-sizing: border-box;
		}
		.title {
			font-family: 'Montserrat', Arial, sans-serif;
			font-size: 2.5rem;
			font-weight: 700;
			text-align: center;
			letter-spacing: 2px;
			margin-bottom: 8px;
		}
		.subtitle {
			color: var(--text-sub);
			font-size: 1.15rem;
			text-align: center;
			margin-bottom: 32px;
			font-weight: 400;
			line-height: 1.4;
		}
		.progress-card {
			background: var(--card-bg);
			border-radius: 20px;
			border: 2px solid var(--card-border);
			padding: 20px 20px 16px 20px;
			margin-bottom: 28px;
			box-sizing: border-box;
			box-shadow: 0 2px 8px #0002;
		}
		.progress-label {
			color: var(--text-main);
			font-size: 1.15rem;
			font-weight: 500;
			margin-bottom: 10px;
		}
		.progress-bar-bg {
			background: var(--progress-bar-bg);
			border-radius: 999px;
			height: 22px;
			width: 100%;
			position: relative;
			overflow: hidden;
			margin-bottom: 0;
		}
		.progress-bar {
			background: var(--progress-bar);
			height: 100%;
			width: 68%;
			border-radius: 999px;
			transition: width 0.4s;
			position: absolute;
			left: 0; top: 0;
		}
		.progress-percent {
			position: absolute;
			right: 20px;
			top: 20px;
			color: var(--text-main);
			font-size: 1.1rem;
			font-weight: 500;
		}
		.card {
			background: var(--card-bg);
			border-radius: 20px;
			border: 2px solid var(--card-border);
			padding: 22px 20px 20px 20px;
			margin-bottom: 28px;
			box-sizing: border-box;
			box-shadow: 0 2px 8px #0002;
			position: relative;
			display: flex;
			flex-direction: column;
			gap: 12px;
		}
		.card-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 8px;
		}
		.icon-bg {
			background: #35353a;
			border-radius: 50%;
			width: 48px;
			height: 48px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.pill {
			background: var(--pill-bg);
			color: var(--pill-text);
			border-radius: 999px;
			font-size: 1rem;
			font-weight: 500;
			padding: 6px 18px;
			margin-left: 8px;
		}
		.card-title {
			font-family: 'Montserrat', Arial, sans-serif;
			font-size: 1.35rem;
			font-weight: 700;
			margin: 0 0 2px 0;
		}
		.card-desc {
			color: var(--text-sub);
			font-size: 1.05rem;
			font-weight: 400;
			margin-bottom: 10px;
		}
		.card-btn {
			background: var(--button-bg);
			color: var(--button-text);
			border: none;
			border-radius: 14px;
			font-size: 1.2rem;
			font-weight: 500;
			padding: 14px 0;
			width: 100%;
			margin-top: 8px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			transition: background 0.2s;
			box-shadow: 0 2px 8px #ff3b3f22;
		}
		.card-btn:hover {
			background: var(--button-bg-hover);
		}
		.arrow {
			display: inline-block;
			vertical-align: middle;
			margin-left: 2px;
		}
		@media (max-width: 480px) {
			.container {
				padding: 24px 4vw 0 4vw;
				max-width: 100vw;
			}
			.title {
				font-size: 2rem;
			}
			.card, .progress-card {
				padding: 18px 8px 16px 8px;
			}
			.card-title {
				font-size: 1.1rem;
			}
			.card-btn {
				font-size: 1rem;
				padding: 12px 0;
			}
			.icon-bg {
				width: 40px;
				height: 40px;
			}
			.pill {
				font-size: 0.95rem;
				padding: 5px 12px;
			}
		}
	</style>

	<!-- Portrait enforcement -->
	<style>
		.portrait-blocker { display:none; position:fixed; inset:0; background:#18181a; color:#fff; z-index:9999; align-items:center; justify-content:center; text-align:center; padding:20px; }
		.portrait-blocker.show { display:flex; }
		.portrait-blocker h2 { font-size:1.4rem; margin-bottom:8px; }
		.portrait-blocker p { color:#b3b3b7; font-size:1rem; }
	</style>
	<script>
		function updatePortraitBlock() {
			const pb = document.getElementById('portrait-block');
			if(!pb) return;
			// prefer orientation API if available
			const isPortrait = window.matchMedia && window.matchMedia('(orientation: portrait)').matches;
			if(isPortrait) pb.classList.remove('show'); else pb.classList.add('show');
		}
		window.addEventListener('resize', updatePortraitBlock);
		window.addEventListener('orientationchange', updatePortraitBlock);
		document.addEventListener('DOMContentLoaded', updatePortraitBlock);
	</script>
</head>
<body>
	<div id="portrait-block" class="portrait-blocker" role="dialog" aria-live="polite">
		<div>
			<h2>Please rotate your device</h2>
			<p>This app works best in portrait orientation. Rotate your device to continue.</p>
		</div>
	</div>
	<div class="container">
		<div class="title">FORENSIC LENS</div>
		<div class="subtitle">Master forensic photography through<br>interactive training and practice.</div>

		<div class="progress-card" style="position: relative;">
			<div class="progress-label">Current Progress</div>
			<div class="progress-bar-bg">
				<div class="progress-bar" style="width: 0%;"></div>
			</div>
			<div class="progress-percent" style="right: 20px; top: 18px;">0%</div>
		</div>

		<div class="card">
			<div class="card-header">
				<div class="icon-bg">
					<!-- Brain SVG -->
					<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="14" cy="14" r="14" fill="#35353a"/>
						<path d="M10.5 19c-1.5 0-2.5-1.2-2.5-2.5 0-.7.3-1.3.7-1.8-.1-.3-.2-.7-.2-1.1 0-1.1.9-2 2-2 .2 0 .4 0 .6.1.2-.7.8-1.2 1.6-1.2.2 0 .4 0 .6.1.2-.7.8-1.2 1.6-1.2 1.1 0 2 .9 2 2 0 .2 0 .4-.1.6.7.2 1.2.8 1.2 1.6 0 .2 0 .4-.1.6.7.2 1.2.8 1.2 1.6 0 1.1-.9 2-2 2-.2 0-.4 0-.6-.1-.2.7-.8 1.2-1.6 1.2-.2 0-.4 0-.6-.1-.2.7-.8 1.2-1.6 1.2z" fill="#fff"/>
					</svg>
				</div>
				<div class="pill" id="modules-pill">0/4 completed</div>
			</div>
			<div class="card-title">Training Modules</div>
			<div class="card-desc">Learn camera fundamentals and forensic photography theory.</div>
            <a href="./training-modules.html" class="card-btn">Start Module <span class="arrow">&#8594;</span></a>
		</div>

		<div class="card">
			<div class="card-header">
				<div class="icon-bg">
					<!-- Camera SVG -->
					<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="14" cy="14" r="14" fill="#35353a"/>
						<path d="M19 18.5H9c-.8 0-1.5-.7-1.5-1.5v-5c0-.8.7-1.5 1.5-1.5h1.1l.6-1.2c.2-.3.5-.5.9-.5h3.8c.4 0 .7.2.9.5l.6 1.2H19c.8 0 1.5.7 1.5 1.5v5c0 .8-.7 1.5-1.5 1.5zM14 12.5A2.5 2.5 0 1 0 14 17.5a2.5 2.5 0 0 0 0-5z" fill="#fff"/>
					</svg>
				</div>
				<div class="pill" id="practice-pill">0/4 completed</div>
			</div>
			<div class="card-title">Practice Levels</div>
			<div class="card-desc">Interactive forensic photography challenges</div>
			<a href="./practice-levels.html" class="card-btn">Start Practice <span class="arrow">&#8594;</span></a>
		</div>
	</div>

		<!-- Cloud progress (Firebase) and progression engine -->
		<script type="module" src="./algo/firebase.js"></script>
		<script src="./algo/algo.js"></script>
		<script>
			(function(){
				const TOTAL_STEPS = 12; // 4 modules + 4 practice levels + 4 quizzes

						function readFlag(key){
							try{
								const v = localStorage.getItem(key);
								if(v == null) return false;
								const s = String(v).trim().toLowerCase();
								return s === 'true' || s === '1';
							}catch(e){ return false; }
						}

				function countProgress(){
					let modules=0, practices=0, quizzes=0;
					for(let i=1;i<=4;i++){
						const mod = (window.ForensicFlow && typeof ForensicFlow.isModuleDone==='function') ? ForensicFlow.isModuleDone(i) : readFlag(`module${i}_done`);
						const prac = (window.ForensicFlow && typeof ForensicFlow.isPracticeDone==='function') ? ForensicFlow.isPracticeDone(i) : readFlag(`practice${i}_done`);
						const qok = (window.ForensicFlow && typeof ForensicFlow.quizPass==='function') ? ForensicFlow.quizPass(i) : readFlag(`quiz${i}_pass`);
						if(mod) modules++;
						if(prac) practices++;
						if(qok) quizzes++;
					}
					const done = modules + practices + quizzes;
					const pct = Math.round((done / TOTAL_STEPS) * 100);
					return { modules, practices, quizzes, done, pct: Math.max(0, Math.min(100, pct)) };
				}

						async function applyProgress(){
							const { modules, practices, quizzes, pct, done } = countProgress();
					const bar = document.querySelector('.progress-bar');
					const lbl = document.querySelector('.progress-percent');
					if(bar) bar.style.width = pct + '%';
					if(lbl) lbl.textContent = pct + '%';
					const modPill = document.getElementById('modules-pill');
					const pracPill = document.getElementById('practice-pill');
					if(modPill) modPill.textContent = `${modules}/4 completed`;
					if(pracPill) pracPill.textContent = `${practices}/4 completed`;
							// Optional: if we have progress and cloud is ready, sync snapshot
							try{
								if(done > 0 && window.ForensicCloud && window.ForensicCloud._ready && window.ForensicFlow && typeof window.ForensicFlow.snapshot==='function'){
									const ok = await window.ForensicCloud._ready; if(ok){
										try{ await window.ForensicCloud.saveProgress(window.ForensicFlow.snapshot()); }catch(_){ }
									}
								}
							}catch(_){ }
							// Dev hint: if pct == 0 but any LS flag true, log for diagnosis
							try{
								if(pct === 0){
									let any = false; for(let i=1;i<=4;i++){ if(readFlag(`module${i}_done`) || readFlag(`practice${i}_done`) || readFlag(`quiz${i}_pass`)) { any = true; break; } }
									if(any) console.warn('[ForensicLens] Progress flags found in localStorage but computed pct is 0.');
								}
							}catch(_){ }
				}

						async function hydrateThenApply(){
							// Apply immediately from localStorage so users see progress without waiting for auth
							try { applyProgress(); } catch(_) {}
							try{
								if(window.ForensicCloud && window.ForensicCloud._ready){
									const ok = await window.ForensicCloud._ready;
									if(!ok) { try{ console.warn('[ForensicLens] Not signed in; progress will sync after native token.'); }catch(_){} }
								}
							}catch(e){ /* ignore */ }
							// Apply again after hydration/auth
							applyProgress();
						}

								// Initial run when DOM is ready
								document.addEventListener('DOMContentLoaded', ()=>{
									hydrateThenApply();
									// extra retries to catch late hydration or async module loads
									setTimeout(applyProgress, 250);
									setTimeout(applyProgress, 1000);
									setTimeout(applyProgress, 2000);
								});

				// Update when native auth restores progress
				window.addEventListener('forensic-progress-restored', applyProgress);
				// Update if another tab updates storage (defensive)
				window.addEventListener('storage', applyProgress);
			})();
		</script>
</body>
</html>
