<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" />
    <title>Module 4 Quiz â€” UV Light</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'], heading: ['Montserrat','ui-sans-serif','system-ui'] },
                    colors: { bg: '#0f0f10', card: '#232327', muted: '#b3b3b7', accent: '#ff3b3f' }
                }
            }
        }
    </script>
    <style>
        @media only screen and (orientation: landscape){
            body::before{content:'Please rotate your device to portrait';position:fixed;inset:0;background:#0f0f10;color:#fff;display:flex;align-items:center;justify-content:center;font-size:1.1rem;z-index:9999}
            #main-content{display:none !important}
        }
    /* Confetti + modal styles */
    #confetti-canvas { position:fixed; inset:0; width:100vw; height:100vh; pointer-events:none; z-index:9999; }
    .quiz-modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.65); display:none; align-items:center; justify-content:center; z-index:800; }
    .quiz-modal-overlay[aria-hidden="false"] { display:flex; }
    .quiz-modal { width:100%; max-width:420px; background:#18181a; border:1px solid #2e2e31; border-radius:20px; padding:28px 26px 30px; text-align:center; box-shadow:0 10px 38px -10px rgba(0,0,0,0.6); font-family:Inter, Arial, sans-serif; }
    .quiz-modal h2 { font-family:Montserrat, sans-serif; font-size:26px; margin:0 0 10px; letter-spacing:.5px; }
    .quiz-modal p { margin:0 0 18px; color:#d0d0d4; line-height:1.4; }
    .quiz-modal .actions { display:flex; gap:12px; justify-content:center; }
    .quiz-btn { flex:1; padding:14px 18px; border-radius:14px; font-weight:600; border:1px solid #ff3b3f; background:#ff3b3f; color:#fff; cursor:pointer; font-size:15px; }
    .quiz-btn.secondary { background:transparent; border-color:#444; color:#eee; }
    </style>
</head>
<body class="min-h-screen bg-bg text-white font-sans overflow-hidden">
    <div id="main-content" class="max-w-[760px] mx-auto px-4 pt-5 pb-[140px]">
        <header class="grid [grid-template-columns:56px_1fr_56px] items-center justify-items-center gap-3 text-center">
            <button onclick="window.location.href='../index.html'" aria-label="Back"
                    class="w-14 h-14 rounded-xl border-2 border-white/20 bg-[#232326] text-white/60 grid place-items-center">â—€</button>
            <div class="flex flex-col items-center">
                <h1 class="font-heading text-[28px] font-bold leading-tight">Module 4 Quiz</h1>
                <p class="text-muted">UV Light</p>
            </div>
            <div aria-hidden="true"></div>
        </header>
        <div id="progress" class="flex gap-3 mt-5 w-full"></div>

        <main class="mt-4">
            <section class="bg-card border border-white/5 rounded-2xl p-5">
                <div class="space-y-3">
                    <div id="qBadge" class="inline-flex items-center justify-center px-3 h-8 rounded-lg bg-gradient-to-b from-[#ff6b6b] to-[#e23b3b] font-bold">Q1</div>
                    <h2 id="qText" class="font-semibold text-lg">Question text</h2>
                    <div id="choices" class="mt-1 flex flex-col gap-3"></div>
                </div>
            </section>
        </main>

        <nav class="fixed left-1/2 -translate-x-1/2 bottom-4 w-[calc(100%-40px)] max-w-[760px] flex flex-col gap-3">
            <button id="prevBtn" class="w-full h-14 rounded-xl border border-white/10 bg-transparent text-white/60 font-bold disabled:opacity-50">Previous</button>
            <button id="nextBtn" class="w-full h-16 rounded-xl font-bold text-white bg-gradient-to-r from-[#ff6b6b] to-[#e23b3b] disabled:opacity-45">Next â†’</button>
        </nav>
    </div>

    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas" aria-hidden="true"></canvas>
    <!-- Pass Modal -->
    <div id="quiz-pass-modal" class="quiz-modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="quizPassHeading" aria-modal="true">
        <div class="quiz-modal">
            <h2 id="quizPassHeading">Congratulations! ðŸŽ‰</h2>
            <p id="quizPassMsg">You've completed this lesson.</p>
            <div class="actions">
                <button id="quizContinueBtn" class="quiz-btn">Continue</button>
            </div>
        </div>
    </div>
    <!-- Fail Modal -->
    <div id="quiz-fail-modal" class="quiz-modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="quizFailHeading" aria-modal="true">
        <div class="quiz-modal">
            <h2 id="quizFailHeading">Try Again</h2>
            <p id="quizFailMsg">You need at least 4 correct answers to pass. Retake the quiz to improve your result.</p>
            <div class="actions">
                <button id="quizRetakeBtn" class="quiz-btn" style="background:#2f2f33;border-color:#444;">Retake Quiz</button>
            </div>
        </div>
    </div>

    <script>
        const quiz = [
            { q: 'What is the primary purpose of using UV light in forensic photography?', choices: ['To increase the sharpness of photos','To brighten the entire crime scene','To eliminate shadows on evidence','To make evidence glow for easier detection'], a: 3 },
            { q: 'Which type of evidence can UV light reveal?', choices: ['Latent fingerprints','Bruises under the skin','Biological fluids','All of the above'], a: 3 },
            { q: 'Why must the environment be darkened when using UV light in forensic photography?', choices: ['To make the fluorescence more visible','To save camera battery','To increase shutter speed','To reduce reflections on surfaces'], a: 0 },
            { q: 'What equipment is often placed in front of the camera lens when photographing with UV light?', choices: ['A magnifying lens','A zoom lens','A barrier filter','A polarizer filter'], a: 2 },
            { q: 'When photographing with UV light, why is it important to use a barrier filter on the camera lens?', choices: ['To soften shadows','To zoom closer to the evidence','To block visible light and capture only fluorescence','To increase camera sharpness'], a: 2 },
        ];

        let idx = 0;
        const answers = Array(quiz.length).fill(null);

        const progressEl = document.getElementById('progress');
        const qBadge = document.getElementById('qBadge');
        const qText = document.getElementById('qText');
        const choicesEl = document.getElementById('choices');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        function progressSegment(state){
            const base = 'h-[14px] rounded-[12px] flex-1 min-w-[38px]';
            if(state === 'active' || state === 'completed'){
                return `<div class="${base} bg-gradient-to-r from-[#ff6b6b] to-[#e23b3b]"></div>`
            }
            return `<div class="${base} bg-[#3a3a3c]"></div>`
        }

        function renderProgress(){
            progressEl.innerHTML = '';
            for(let i=0;i<quiz.length;i++){
                let state = 'idle';
                if(answers[i] !== null) state = 'completed';
                else if(i === idx) state = 'active';
                progressEl.insertAdjacentHTML('beforeend', progressSegment(state));
            }
        }

        function render(){
            const item = quiz[idx];
            qBadge.textContent = 'Q'+(idx+1);
            qText.textContent = item.q;
            choicesEl.innerHTML = '';
            item.choices.forEach((c,i)=>{
                const choice = document.createElement('button');
                choice.type = 'button';
                choice.className = 'choice w-full bg-[#2b2b2f] border border-white/5 rounded-xl p-4 flex items-center gap-4 text-left focus:outline-none focus:ring-2 focus:ring-[#ff3b3f]/40';
                choice.innerHTML = `
                    <div class=\"w-11 h-11 rounded-full bg-gradient-to-b from-[#ff6b6b] to-[#e23b3b] grid place-items-center font-bold\">${String.fromCharCode(65+i)}</div>
                    <div class=\"flex-1 leading-snug\">${c}</div>
                `;
                const select = () => { answers[idx] = i; render(); };
                choice.addEventListener('click', select);
                choice.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); select(); }});
                if(answers[idx] === i){ choice.classList.add('ring-2','ring-[#ff3b3f]/30'); }
                choicesEl.appendChild(choice);
            });

            prevBtn.disabled = (idx===0);
            prevBtn.classList.toggle('opacity-50', idx===0);
            nextBtn.textContent = idx===quiz.length-1 ? 'Submit' : 'Next â†’';
            nextBtn.disabled = (answers[idx] === null);
            renderProgress();
        }

        prevBtn.addEventListener('click', ()=>{ if(idx>0){ idx--; render(); } });
    // Completion feedback + confetti (pass requires >=4 correct)
        let submitted = false;
        function launchConfetti(durationMs = 4000){
            const canvas = document.getElementById('confetti-canvas');
            if(!canvas) return; const ctx = canvas.getContext('2d');
            function fit(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
            fit(); window.addEventListener('resize', fit);
            const colors = ['#ff3b3f','#ff6b6b','#ffffff','#ffd54a','#ff9f43'];
            const pieces = Array.from({length:160}, ()=>({
                x: Math.random()*canvas.width,
                y: -20 - Math.random()*canvas.height,
                r: 6+Math.random()*10,
                c: colors[Math.floor(Math.random()*colors.length)],
                vy: 2+Math.random()*4,
                vx: -2+Math.random()*4,
                rot: Math.random()*Math.PI*2,
                vr: -0.3+Math.random()*0.6
            }));
            let running = true; const endTime = performance.now()+durationMs;
            (function frame(t){
                if(!running) return; ctx.clearRect(0,0,canvas.width,canvas.height);
                pieces.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; if(p.y>canvas.height+40) { p.y=-20; p.x=Math.random()*canvas.width; }
                    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.c; ctx.beginPath(); ctx.rect(-p.r/2,-p.r/2,p.r,p.r); ctx.fill(); ctx.restore(); });
                if(t < endTime){ requestAnimationFrame(frame); } else { running=false; ctx.clearRect(0,0,canvas.width,canvas.height); }
            })(performance.now());
        }

        function openPassModal(){
            const modal = document.getElementById('quiz-pass-modal');
            if(!modal) return; modal.setAttribute('aria-hidden','false');
            const msg = document.getElementById('quizPassMsg');
            if(msg) msg.textContent = 'Great job completing the quiz!';
            launchConfetti();
            const btn = document.getElementById('quizContinueBtn');
            if(btn){ btn.onclick = ()=>{ modal.setAttribute('aria-hidden','true'); proceedToResults(); }; }
        }

        function openFailModal(){
            const modal = document.getElementById('quiz-fail-modal');
            if(!modal) return; modal.setAttribute('aria-hidden','false');
            const retake = document.getElementById('quizRetakeBtn');
            if(retake){
                retake.onclick = ()=>{
                    modal.setAttribute('aria-hidden','true');
                    // reset quiz state
                    for(let i=0;i<answers.length;i++) answers[i] = null;
                    idx = 0; submitted = false;
                    try{ localStorage.removeItem('quiz4_answers'); localStorage.removeItem('quiz4_score'); localStorage.removeItem('quiz4_total'); localStorage.removeItem('quiz4_passed'); }catch(e){}
                    render();
                };
            }
        }

        function proceedToResults(){ window.location.href = 'results/quiz4-result.html'; }

        nextBtn.addEventListener('click', ()=>{
            if(idx < quiz.length-1){ idx++; render(); return; }
            if(submitted) return; submitted = true;
            const key = [3,3,0,2,2];
            const score = answers.reduce((acc,ans,i)=> acc + (ans===key[i]?1:0), 0);
            const passed = score >= 4; // 4 or 5 out of 5
            try{
                localStorage.setItem('quiz4_answers', JSON.stringify(answers));
                localStorage.setItem('quiz4_score', String(score));
                localStorage.setItem('quiz4_total', String(quiz.length));
                localStorage.setItem('quiz4_passed', String(passed));
            }catch(e){}
            if(passed){ openPassModal(); } else { openFailModal(); }
        });

        render();
    </script>
</body>
</html>